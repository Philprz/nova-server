# SYNTH√àSE - D√©veloppement POC Cr√©ation de Clients avec Contr√¥le de Doublons

## CONTEXTE PROJET
**POC d'int√©gration LLM (Claude) - Salesforce - SAP**
- Objectif : G√©n√©ration automatique de devis via langage naturel
- Workflow : Extraction besoins ‚Üí Validation client ‚Üí R√©cup√©ration produits SAP ‚Üí Cr√©ation devis Salesforce
- **Probl√©matique identifi√©e** : Besoin de cr√©er des clients quand ils n'existent pas dans la base

## P√âRIM√àTRE G√âOGRAPHIQUE VALID√â
- **March√©s principaux** : France (üá´üá∑) et USA (üá∫üá∏)
- **March√©s secondaires** : Royaume-Uni, Singapour
- **Focus d√©veloppement** : France + USA prioritaires

## SP√âCIFICATIONS FONCTIONNELLES VALID√âES

### **FRANCE üá´üá∑**
- ‚úÖ **SIRET obligatoire** (contr√¥le unicit√© absolu)
- ‚úÖ **API INSEE Sirene** pour validation + enrichissement
- ‚úÖ **API Adresse gouv.fr** pour normalisation adresses
- ‚úÖ **Enrichissement automatique** : secteur, adresse officielle, statut

### **USA üá∫üá∏**
- ‚úÖ **Nom + √âtat + Code postal obligatoires**
- ‚úÖ **EIN optionnel** (si disponible)
- ‚úÖ **Pas d'API officielle** ‚Üí Validation manuelle renforc√©e
- ‚úÖ **Contr√¥le doublons par similarit√©**

### **CONTR√îLE DE DOUBLONS**
- ‚úÖ **Seuil de similarit√©** : 80%
- ‚úÖ **Algorithme** : Recherche floue nom + adresse
- ‚úÖ **Action si doublon d√©tect√©** : Proposer mise √† jour de l'existant
- ‚úÖ **Ne pas cr√©er de nouveau client** si doublon confirm√©

## ARCHITECTURE TECHNIQUE √Ä D√âVELOPPER

### **1. Services de base requis**
```
services/client_validator.py     # Validation SIRET + EIN
services/address_normalizer.py  # API Adresse gouv.fr
services/duplicate_detector.py  # D√©tection similarit√© 80%
services/client_enricher.py     # Enrichissement INSEE
```

### **2. Routes API √† cr√©er**
```
routes/routes_clients.py:
- POST /validate_client_data    # Validation avant cr√©ation
- POST /create_client          # Cr√©ation avec contr√¥les
- GET /search_clients          # Recherche + similarit√©
- PUT /update_client           # Mise √† jour propos√©e
- GET /client_requirements     # Exigences par pays
```

### **3. Workflow technique valid√©**

**FRANCE :**
```
1. SIRET saisi ‚Üí Validation API INSEE
2. Si valide ‚Üí Enrichissement automatique
3. Normalisation adresse ‚Üí API gouv.fr
4. V√©rification doublons ‚Üí Base existante
5. Si doublon > 80% ‚Üí Proposition mise √† jour
6. Validation utilisateur ‚Üí Cr√©ation/Mise √† jour
```

**USA :**
```
1. Nom + √âtat + CP ‚Üí Validation format
2. Recherche similarit√© ‚Üí Base existante  
3. Si similaire > 80% ‚Üí Proposition mise √† jour
4. EIN optionnel ‚Üí Validation si fourni
5. Choix utilisateur ‚Üí Cr√©ation/Mise √† jour
```

## INT√âGRATION DANS LE WORKFLOW EXISTANT

### **Point d'int√©gration**
- **D√©clencheur** : Client non trouv√© dans `workflow/devis_workflow.py`
- **M√©thode existante** : `_validate_client()` 
- **Nouvelle logique** : Si client non trouv√© ‚Üí Processus cr√©ation guid√©e

### **Exp√©rience utilisateur**
```
Utilisateur saisit : "devis pour ABC Industries"
‚Üí Client non trouv√©
‚Üí "Voulez-vous cr√©er ce client ?"
‚Üí Si France : "Quel est le SIRET ?"
‚Üí Si USA : "Dans quel √âtat ?"
‚Üí Validation + proposition mise √† jour si doublon
‚Üí Cr√©ation confirm√©e ‚Üí Reprise workflow devis
```

## APIS EXTERNES √Ä INT√âGRER

### **APIs officielles gratuites**
- **INSEE Sirene** : `api.insee.fr/entreprises/sirene/V3`
- **API Adresse** : `api-adresse.data.gouv.fr`

### **APIs optionnelles (enrichissement)**
- **Pappers.fr** : Donn√©es entreprises fran√ßaises enrichies
- **OpenCorporates** : Donn√©es internationales (payant)

## D√âPENDANCES TECHNIQUES
```python
# Nouvelles d√©pendances √† ajouter
requirements.txt:
+ email-validator      # Validation emails
+ python-multipart    # Formulaires
+ fuzzywuzzy          # Similarit√© cha√Ænes
+ python-Levenshtein  # Algorithme distance
+ requests-cache      # Cache API calls
```

## ORDRE DE D√âVELOPPEMENT RECOMMAND√â

### **Phase 1 - Services de base**
1. `services/client_validator.py` ‚Üí Validation SIRET
2. `services/address_normalizer.py` ‚Üí API Adresse gouv.fr
3. Tests unitaires des services

### **Phase 2 - D√©tection doublons**
1. `services/duplicate_detector.py` ‚Üí Algorithme similarit√©
2. Int√©gration avec bases Salesforce + SAP
3. Tests avec donn√©es r√©elles

### **Phase 3 - Routes et int√©gration**
1. `routes/routes_clients.py` ‚Üí API compl√®te
2. Int√©gration dans `workflow/devis_workflow.py`
3. Tests bout-en-bout

### **Phase 4 - Interface utilisateur**
1. Formulaires de cr√©ation guid√©e
2. Interface validation doublons
3. Tests utilisateur final

---

**üéØ OBJECTIF FINAL** : Lors de la g√©n√©ration d'un devis, si le client n'existe pas, le syst√®me guide l'utilisateur pour cr√©er proprement le client (France avec SIRET, USA avec validation renforc√©e) tout en √©vitant les doublons gr√¢ce au contr√¥le √† 80% de similarit√©.